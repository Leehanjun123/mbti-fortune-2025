<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI 궁합 계산기 - 연애, 친구, 직장 궁합 분석</title>
    <meta name="description" content="MBTI 유형별 궁합 점수와 상세 분석. 연애, 친구, 직장에서의 관계 조언">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N1BD4K7BV9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-N1BD4K7BV9');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .compatibility-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #ff6b6b;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .selector-section {
            display: flex;
            justify-content: space-around;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .type-selector {
            flex: 1;
            min-width: 250px;
        }
        
        .selector-label {
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .mbti-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .mbti-option {
            padding: 12px;
            border: 2px solid #feca57;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .mbti-option:hover {
            background: #feca57;
            transform: translateY(-2px);
        }
        
        .mbti-option.selected {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
        }
        
        .result-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .result-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .compatibility-score {
            text-align: center;
            margin: 30px 0;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: 900;
            color: white;
            position: relative;
            background: conic-gradient(#ff6b6b var(--score), #f0f0f0 var(--score));
        }
        
        .score-label {
            font-size: 1.2em;
            color: #666;
            margin-top: 15px;
        }
        
        .relationship-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }
        
        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: #f0f0f0;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #ff6b6b;
            color: white;
        }
        
        .analysis-content {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .analysis-section {
            margin: 20px 0;
        }
        
        .analysis-title {
            font-weight: 700;
            color: #ff6b6b;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .pros, .cons {
            padding: 15px;
            border-radius: 10px;
        }
        
        .pros {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .cons {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .advice-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .share-section {
            text-align: center;
            margin-top: 30px;
        }
        
        .share-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
        }
        
        .chart-container {
            margin: 30px 0;
        }
        
        .stat-bar {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .stat-label {
            width: 120px;
            font-weight: 600;
        }
        
        .stat-progress {
            flex: 1;
            height: 25px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            transition: width 1s;
        }
        
        .stat-value {
            margin-left: 15px;
            font-weight: 700;
            color: #ff6b6b;
        }
    </style>
    <!-- 통합 네비게이션 -->
    <script src="navigation.js"></script>
    <!-- 프리미엄 시스템 -->
    <script src="premium.js"></script>
    <!-- A/B 테스트 -->
    <script src="ab-testing.js"></script>
    <link rel="stylesheet" href="design-system.css">
    <script src="optimization.js"></script>
    <script src="analytics.js"></script>
</head>
<body>
    <div class="container">
        <div class="compatibility-card">
            <h1>💕 MBTI 궁합 계산기</h1>
            
            <div class="selector-section">
                <div class="type-selector">
                    <div class="selector-label">내 MBTI 유형</div>
                    <div class="mbti-grid" id="type1Grid">
                        <!-- MBTI types will be generated by JS -->
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; justify-content: center; font-size: 2em;">
                    ❤️
                </div>
                
                <div class="type-selector">
                    <div class="selector-label">상대방 MBTI 유형</div>
                    <div class="mbti-grid" id="type2Grid">
                        <!-- MBTI types will be generated by JS -->
                    </div>
                </div>
            </div>
            
            <div id="resultSection" class="result-section">
                <!-- Results will be dynamically inserted here -->
            </div>
        </div>
    </div>
    
    <script>
        const mbtiTypes = ['INTJ', 'INTP', 'ENTJ', 'ENTP', 'INFJ', 'INFP', 'ENFJ', 'ENFP', 
                          'ISTJ', 'ISFJ', 'ESTJ', 'ESFJ', 'ISTP', 'ISFP', 'ESTP', 'ESFP'];
        
        // 궁합 데이터베이스 (실제로는 256개 조합이 필요하지만, 주요 조합만 정의)
        const compatibilityData = {
            'INTJ-ENFP': {
                overall: 92,
                love: { score: 95, desc: '완벽한 보완 관계! 서로의 약점을 강점으로 바꿔줍니다.' },
                friend: { score: 88, desc: '지적 호기심을 자극하는 최고의 친구가 될 수 있습니다.' },
                work: { score: 90, desc: 'INTJ의 전략과 ENFP의 창의성이 시너지를 만듭니다.' },
                pros: ['서로를 성장시키는 관계', '지적 자극이 풍부함', '균형잡힌 의사결정'],
                cons: ['감정 표현 방식 차이', '일정 관리 스타일 충돌', '사교 활동 선호도 차이'],
                advice: 'INTJ는 ENFP의 감정을 인정하고, ENFP는 INTJ의 독립적 시간을 존중하세요.',
                stats: {
                    '의사소통': 85,
                    '감정교류': 78,
                    '가치관': 90,
                    '생활습관': 72,
                    '미래비전': 94
                }
            },
            'ENFP-INTJ': {
                overall: 92,
                love: { score: 95, desc: '운명적인 만남! 서로에게 없는 것을 채워줍니다.' },
                friend: { score: 88, desc: '깊이 있는 대화와 모험을 함께 즐길 수 있습니다.' },
                work: { score: 90, desc: 'ENFP의 열정과 INTJ의 체계가 완벽한 팀을 만듭니다.' },
                pros: ['상호 보완적 성격', '끊임없는 성장 동력', '창의적 문제 해결'],
                cons: ['계획성 차이', '감정 처리 방식 차이', '휴식 스타일 차이'],
                advice: 'ENFP는 INTJ의 계획을 존중하고, INTJ는 ENFP의 즉흥성을 받아들이세요.',
                stats: {
                    '의사소통': 85,
                    '감정교류': 78,
                    '가치관': 90,
                    '생활습관': 72,
                    '미래비전': 94
                }
            },
            'INFJ-INFJ': {
                overall: 88,
                love: { score: 92, desc: '깊은 영혼의 연결! 서로를 완벽하게 이해합니다.' },
                friend: { score: 90, desc: '평생 지기가 될 수 있는 특별한 우정입니다.' },
                work: { score: 82, desc: '비전을 공유하면 놀라운 일을 해낼 수 있습니다.' },
                pros: ['완벽한 감정 이해', '깊이 있는 대화', '비슷한 가치관'],
                cons: ['갈등 회피 성향', '과도한 완벽주의', '외부 활동 부족'],
                advice: '서로의 감정에 너무 몰입하지 말고, 현실적인 목표를 세우세요.',
                stats: {
                    '의사소통': 95,
                    '감정교류': 98,
                    '가치관': 96,
                    '생활습관': 88,
                    '미래비전': 90
                }
            }
            // 기본값 설정 (나머지 조합들)
        };
        
        // 기본 궁합 점수 계산 함수
        function getDefaultCompatibility(type1, type2) {
            // 같은 유형
            if (type1 === type2) {
                return {
                    overall: 75,
                    love: { score: 70, desc: '서로를 거울처럼 비추는 관계입니다.' },
                    friend: { score: 80, desc: '편안하고 이해가 빠른 친구 관계입니다.' },
                    work: { score: 75, desc: '비슷한 업무 스타일로 협력이 수월합니다.' },
                    pros: ['높은 이해도', '편안한 소통', '비슷한 관심사'],
                    cons: ['같은 약점 공유', '성장 동력 부족', '새로움 부족'],
                    advice: '서로의 comfort zone을 벗어나 새로운 도전을 함께 하세요.',
                    stats: {
                        '의사소통': 80,
                        '감정교류': 75,
                        '가치관': 85,
                        '생활습관': 80,
                        '미래비전': 75
                    }
                };
            }
            
            // 인지 기능 기반 기본 점수
            const cognitiveScore = calculateCognitiveCompatibility(type1, type2);
            return {
                overall: cognitiveScore,
                love: { score: cognitiveScore + 5, desc: '서로 다른 매력에 끌리는 관계입니다.' },
                friend: { score: cognitiveScore, desc: '서로를 보완하는 친구 관계입니다.' },
                work: { score: cognitiveScore - 5, desc: '협력하면 좋은 결과를 만들 수 있습니다.' },
                pros: ['다양한 관점', '상호 성장', '새로운 경험'],
                cons: ['의사소통 차이', '우선순위 차이', '에너지 레벨 차이'],
                advice: '서로의 차이를 인정하고 장점으로 활용하세요.',
                stats: {
                    '의사소통': cognitiveScore - 10,
                    '감정교류': cognitiveScore,
                    '가치관': cognitiveScore + 5,
                    '생활습관': cognitiveScore - 15,
                    '미래비전': cognitiveScore + 10
                }
            };
        }
        
        function calculateCognitiveCompatibility(type1, type2) {
            // 간단한 인지기능 기반 점수 계산
            let score = 50;
            
            // E-I 차이
            if (type1[0] !== type2[0]) score += 10;
            
            // N-S 일치
            if (type1[1] === type2[1]) score += 15;
            
            // T-F 보완
            if (type1[2] !== type2[2]) score += 5;
            
            // J-P 차이
            if (type1[3] !== type2[3]) score += 10;
            
            return Math.min(95, Math.max(40, score + Math.floor(Math.random() * 10)));
        }
        
        let selectedType1 = null;
        let selectedType2 = null;
        let currentTab = 'love';
        
        // Initialize MBTI grids
        function initializeGrids() {
            const grid1 = document.getElementById('type1Grid');
            const grid2 = document.getElementById('type2Grid');
            
            mbtiTypes.forEach(type => {
                // Grid 1
                const btn1 = document.createElement('button');
                btn1.className = 'mbti-option';
                btn1.textContent = type;
                btn1.onclick = () => selectType(1, type);
                grid1.appendChild(btn1);
                
                // Grid 2
                const btn2 = document.createElement('button');
                btn2.className = 'mbti-option';
                btn2.textContent = type;
                btn2.onclick = () => selectType(2, type);
                grid2.appendChild(btn2);
            });
        }
        
        function selectType(grid, type) {
            if (grid === 1) {
                selectedType1 = type;
                document.querySelectorAll('#type1Grid .mbti-option').forEach(btn => {
                    btn.classList.toggle('selected', btn.textContent === type);
                });
            } else {
                selectedType2 = type;
                document.querySelectorAll('#type2Grid .mbti-option').forEach(btn => {
                    btn.classList.toggle('selected', btn.textContent === type);
                });
            }
            
            if (selectedType1 && selectedType2) {
                calculateCompatibility();
            }
        }
        
        function calculateCompatibility() {
            const key = `${selectedType1}-${selectedType2}`;
            const reverseKey = `${selectedType2}-${selectedType1}`;
            
            let data = compatibilityData[key] || compatibilityData[reverseKey] || 
                      getDefaultCompatibility(selectedType1, selectedType2);
            
            displayResults(data);
        }
        
        function displayResults(data) {
            const resultHTML = `
                <div class="compatibility-score">
                    <div class="score-circle" style="--score: ${data.overall}%">
                        <span>${data.overall}%</span>
                    </div>
                    <div class="score-label">전체 궁합 점수</div>
                </div>
                
                <div class="relationship-tabs">
                    <button class="tab-btn active" onclick="showTab('love')">💕 연애</button>
                    <button class="tab-btn" onclick="showTab('friend')">👥 친구</button>
                    <button class="tab-btn" onclick="showTab('work')">💼 직장</button>
                </div>
                
                <div id="tabContent">
                    ${generateTabContent('love', data)}
                </div>
                
                <div class="chart-container">
                    <h3 style="margin-bottom: 20px;">상세 궁합 분석</h3>
                    ${Object.entries(data.stats).map(([key, value]) => `
                        <div class="stat-bar">
                            <span class="stat-label">${key}</span>
                            <div class="stat-progress">
                                <div class="stat-fill" style="width: ${value}%"></div>
                            </div>
                            <span class="stat-value">${value}%</span>
                        </div>
                    `).join('')}
                </div>
                
                <div class="pros-cons">
                    <div class="pros">
                        <h4>👍 장점</h4>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            ${data.pros.map(pro => `<li>${pro}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>👎 주의점</h4>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            ${data.cons.map(con => `<li>${con}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="advice-box">
                    <h3 style="margin-bottom: 10px;">💡 관계 개선 조언</h3>
                    <p>${data.advice}</p>
                </div>
                
                <div class="share-section">
                    <button class="share-btn" onclick="shareResult()">📤 결과 공유하기</button>
                    <button class="share-btn" style="background: #FEE500; color: #3C1E1E;">
                        카카오톡 공유
                    </button>
                </div>
            `;
            
            document.getElementById('resultSection').innerHTML = resultHTML;
            document.getElementById('resultSection').classList.add('active');
            
            // Animate stats
            setTimeout(() => {
                document.querySelectorAll('.stat-fill').forEach(bar => {
                    bar.style.width = bar.style.width;
                });
            }, 100);
        }
        
        function generateTabContent(tab, data) {
            const tabData = data[tab];
            return `
                <div class="analysis-content">
                    <div class="analysis-section">
                        <div class="analysis-title">${tab === 'love' ? '💕 연애 궁합' : tab === 'friend' ? '👥 친구 궁합' : '💼 직장 궁합'}</div>
                        <div style="font-size: 2em; font-weight: 900; color: #ff6b6b; margin: 10px 0;">
                            ${tabData.score}점
                        </div>
                        <p>${tabData.desc}</p>
                    </div>
                </div>
            `;
        }
        
        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const data = compatibilityData[`${selectedType1}-${selectedType2}`] || 
                        compatibilityData[`${selectedType2}-${selectedType1}`] || 
                        getDefaultCompatibility(selectedType1, selectedType2);
            
            document.getElementById('tabContent').innerHTML = generateTabContent(tab, data);
        }
        
        function shareResult() {
            if (navigator.share) {
                navigator.share({
                    title: `${selectedType1} & ${selectedType2} 궁합 결과`,
                    text: `우리의 궁합 점수를 확인해보세요!`,
                    url: window.location.href
                });
            }
        }
        
        // Initialize
        initializeGrids();
    </script>
</body>
</html>