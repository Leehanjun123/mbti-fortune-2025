<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI ìš´ì„¸ ì•± í…ŒìŠ¤íŠ¸ (ìˆ˜ì • ì™„ë£Œ)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .test-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .test-section h2 {
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .test-btn {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #333;
            border: none;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .test-btn:active {
            transform: translateY(0);
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .status.success {
            background: rgba(46, 204, 113, 0.2);
            border-left: 4px solid #2ecc71;
        }

        .status.error {
            background: rgba(231, 76, 60, 0.2);
            border-left: 4px solid #e74c3c;
        }

        .status.warning {
            background: rgba(241, 196, 15, 0.2);
            border-left: 4px solid #f1c40f;
        }

        .info {
            background: rgba(52, 152, 219, 0.2);
            border-left: 4px solid #3498db;
        }

        .code {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        #console {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #333;
        }

        .iframe-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        iframe {
            width: 100%;
            height: 600px;
            border: none;
            display: block;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        .controls button {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ MBTI ìš´ì„¸ ì•± ìˆ˜ì • ì™„ë£Œ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="status info">
            <strong>ğŸ“‹ ìˆ˜ì • ì™„ë£Œ í•­ëª©:</strong><br>
            âœ… HTMLê³¼ JavaScript ID ë¶ˆì¼ì¹˜ ìˆ˜ì •<br>
            âœ… Service Worker ìºì‹œ íŒŒì¼ëª… ìˆ˜ì •<br>
            âœ… 429 ì—ëŸ¬ ë° Retry-After í—¤ë” ì—ëŸ¬ ì²˜ë¦¬<br>
            âœ… ëˆ„ë½ëœ í•¨ìˆ˜ë“¤ ì¶”ê°€<br>
            âœ… ì „ì²´ MBTI íƒ€ì… ìš´ì„¸ ë°ì´í„° ì¶”ê°€
        </div>

        <div class="test-section">
            <h2>ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            
            <div class="controls">
                <button class="test-btn" onclick="loadApp()">ì•± ë¡œë“œ</button>
                <button class="test-btn" onclick="testStartButton()">ì‹œì‘ ë²„íŠ¼ í…ŒìŠ¤íŠ¸</button>
                <button class="test-btn" onclick="testMBTISelect()">MBTI ì„ íƒ í…ŒìŠ¤íŠ¸</button>
                <button class="test-btn" onclick="testNameInput()">ì´ë¦„ ì…ë ¥ í…ŒìŠ¤íŠ¸</button>
                <button class="test-btn" onclick="testFullFlow()">ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</button>
            </div>
        </div>

        <div class="iframe-container">
            <iframe id="appFrame" src="/index.html"></iframe>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ’» ì½˜ì†” ë¡œê·¸</h2>
            <div id="console"></div>
        </div>
    </div>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `<div style="color: ${getLogColor(type)}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function getLogColor(type) {
            switch(type) {
                case 'success': return '#00ff00';
                case 'error': return '#ff0000';
                case 'warning': return '#ffff00';
                default: return '#00ff00';
            }
        }

        function addTestResult(test, result, details = '') {
            testResults.push({ test, result, details });
            updateTestResults();
        }

        function updateTestResults() {
            const container = document.getElementById('testResults');
            container.innerHTML = testResults.map(r => 
                `<div class="status ${r.result ? 'success' : 'error'}">
                    <strong>${r.test}:</strong> ${r.result ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}
                    ${r.details ? `<br><small>${r.details}</small>` : ''}
                </div>`
            ).join('');
        }

        function loadApp() {
            log('ì•± ë¡œë”© ì‹œì‘...', 'info');
            document.getElementById('appFrame').src = '/index.html?' + Date.now();
            
            setTimeout(() => {
                try {
                    const frame = document.getElementById('appFrame');
                    const frameWindow = frame.contentWindow;
                    
                    if (frameWindow && frameWindow.MBTIApp) {
                        log('âœ… ì•± ë¡œë“œ ì„±ê³µ - MBTIApp ê°ì²´ ë°œê²¬', 'success');
                        addTestResult('ì•± ë¡œë“œ', true, 'MBTIApp ê°ì²´ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë¨');
                    } else {
                        log('âŒ ì•± ë¡œë“œ ì‹¤íŒ¨ - MBTIApp ê°ì²´ ì—†ìŒ', 'error');
                        addTestResult('ì•± ë¡œë“œ', false, 'MBTIApp ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    }
                } catch(e) {
                    log(`âŒ ì•± ë¡œë“œ í…ŒìŠ¤íŠ¸ ì¤‘ ì—ëŸ¬: ${e.message}`, 'error');
                    addTestResult('ì•± ë¡œë“œ', false, `ì—ëŸ¬: ${e.message}`);
                }
            }, 3000);
        }

        function testStartButton() {
            log('ì‹œì‘ ë²„íŠ¼ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                const frame = document.getElementById('appFrame');
                const frameWindow = frame.contentWindow;
                const frameDoc = frame.contentDocument;
                
                const startBtn = frameDoc.querySelector('button[onclick="startMagicalJourney()"]');
                
                if (startBtn) {
                    log('âœ… ì‹œì‘ ë²„íŠ¼ ë°œê²¬', 'success');
                    
                    // ë²„íŠ¼ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
                    if (typeof frameWindow.startMagicalJourney === 'function') {
                        frameWindow.startMagicalJourney();
                        log('âœ… startMagicalJourney í•¨ìˆ˜ ì‹¤í–‰ ì„±ê³µ', 'success');
                        addTestResult('ì‹œì‘ ë²„íŠ¼', true, 'í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ì¡´ì¬í•˜ê³  ì‹¤í–‰ë¨');
                    } else {
                        log('âŒ startMagicalJourney í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ', 'error');
                        addTestResult('ì‹œì‘ ë²„íŠ¼', false, 'startMagicalJourney í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ');
                    }
                } else {
                    log('âŒ ì‹œì‘ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                    addTestResult('ì‹œì‘ ë²„íŠ¼', false, 'ì‹œì‘ ë²„íŠ¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
            } catch(e) {
                log(`âŒ ì‹œì‘ ë²„íŠ¼ í…ŒìŠ¤íŠ¸ ì¤‘ ì—ëŸ¬: ${e.message}`, 'error');
                addTestResult('ì‹œì‘ ë²„íŠ¼', false, `ì—ëŸ¬: ${e.message}`);
            }
        }

        function testMBTISelect() {
            log('MBTI ì„ íƒ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                const frame = document.getElementById('appFrame');
                const frameWindow = frame.contentWindow;
                const frameDoc = frame.contentDocument;
                
                const mbtiBtn = frameDoc.querySelector('button[onclick*="selectMBTI"]');
                
                if (mbtiBtn) {
                    log('âœ… MBTI ì„ íƒ ë²„íŠ¼ ë°œê²¬', 'success');
                    
                    if (typeof frameWindow.selectMBTI === 'function') {
                        frameWindow.selectMBTI('INTJ');
                        log('âœ… selectMBTI í•¨ìˆ˜ ì‹¤í–‰ ì„±ê³µ', 'success');
                        addTestResult('MBTI ì„ íƒ', true, 'selectMBTI í•¨ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™');
                    } else {
                        log('âŒ selectMBTI í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ', 'error');
                        addTestResult('MBTI ì„ íƒ', false, 'selectMBTI í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ');
                    }
                } else {
                    log('âŒ MBTI ì„ íƒ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                    addTestResult('MBTI ì„ íƒ', false, 'MBTI ì„ íƒ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
            } catch(e) {
                log(`âŒ MBTI ì„ íƒ í…ŒìŠ¤íŠ¸ ì¤‘ ì—ëŸ¬: ${e.message}`, 'error');
                addTestResult('MBTI ì„ íƒ', false, `ì—ëŸ¬: ${e.message}`);
            }
        }

        function testNameInput() {
            log('ì´ë¦„ ì…ë ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                const frame = document.getElementById('appFrame');
                const frameWindow = frame.contentWindow;
                const frameDoc = frame.contentDocument;
                
                const nameInput = frameDoc.querySelector('#nameInput');
                
                if (nameInput) {
                    log('âœ… ì´ë¦„ ì…ë ¥ í•„ë“œ ë°œê²¬ (ID: nameInput)', 'success');
                    
                    if (typeof frameWindow.submitName === 'function') {
                        log('âœ… submitName í•¨ìˆ˜ ì¡´ì¬ í™•ì¸', 'success');
                        addTestResult('ì´ë¦„ ì…ë ¥', true, 'nameInput IDì™€ submitName í•¨ìˆ˜ê°€ ì •ìƒ ì‘ë™');
                    } else {
                        log('âŒ submitName í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ', 'error');
                        addTestResult('ì´ë¦„ ì…ë ¥', false, 'submitName í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ');
                    }
                } else {
                    log('âŒ nameInput IDë¥¼ ê°€ì§„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                    addTestResult('ì´ë¦„ ì…ë ¥', false, 'nameInput ID ìš”ì†Œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ');
                }
            } catch(e) {
                log(`âŒ ì´ë¦„ ì…ë ¥ í…ŒìŠ¤íŠ¸ ì¤‘ ì—ëŸ¬: ${e.message}`, 'error');
                addTestResult('ì´ë¦„ ì…ë ¥', false, `ì—ëŸ¬: ${e.message}`);
            }
        }

        function testFullFlow() {
            log('ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            let step = 0;
            const steps = ['ë¡œë“œ', 'MBTI ì„ íƒ', 'ì´ë¦„ ì…ë ¥', 'ê²°ê³¼ í‘œì‹œ'];
            
            function nextStep() {
                if (step >= steps.length) {
                    log('âœ… ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'success');
                    addTestResult('ì „ì²´ í”Œë¡œìš°', true, 'ëª¨ë“  ë‹¨ê³„ê°€ ì •ìƒì ìœ¼ë¡œ ì§„í–‰ë¨');
                    return;
                }
                
                log(`ğŸ“ ë‹¨ê³„ ${step + 1}: ${steps[step]}`, 'info');
                
                try {
                    const frame = document.getElementById('appFrame');
                    const frameWindow = frame.contentWindow;
                    
                    switch(step) {
                        case 0: // ë¡œë“œ í™•ì¸
                            if (frameWindow.MBTIApp) {
                                log('âœ… ì•± ë¡œë“œ í™•ì¸', 'success');
                                step++;
                                setTimeout(nextStep, 1000);
                            } else {
                                throw new Error('ì•±ì´ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                            }
                            break;
                            
                        case 1: // MBTI ì„ íƒ
                            frameWindow.selectMBTI('INTJ');
                            log('âœ… MBTI ì„ íƒ (INTJ)', 'success');
                            step++;
                            setTimeout(nextStep, 1000);
                            break;
                            
                        case 2: // ì´ë¦„ ì…ë ¥
                            const nameInput = frame.contentDocument.querySelector('#nameInput');
                            if (nameInput) {
                                nameInput.value = 'í…ŒìŠ¤íŠ¸';
                                frameWindow.submitName();
                                log('âœ… ì´ë¦„ ì…ë ¥ ë° ì œì¶œ', 'success');
                                step++;
                                setTimeout(nextStep, 2000);
                            } else {
                                throw new Error('ì´ë¦„ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                            }
                            break;
                            
                        case 3: // ê²°ê³¼ í™•ì¸
                            const resultScreen = frame.contentDocument.querySelector('#resultScreen');
                            if (resultScreen && resultScreen.classList.contains('active')) {
                                log('âœ… ê²°ê³¼ í™”ë©´ í‘œì‹œ í™•ì¸', 'success');
                                step++;
                                nextStep();
                            } else {
                                log('âš ï¸ ê²°ê³¼ í™”ë©´ì´ ì•„ì§ í‘œì‹œë˜ì§€ ì•ŠìŒ', 'warning');
                                setTimeout(nextStep, 1000);
                            }
                            break;
                    }
                } catch(e) {
                    log(`âŒ ë‹¨ê³„ ${step + 1} ì‹¤íŒ¨: ${e.message}`, 'error');
                    addTestResult('ì „ì²´ í”Œë¡œìš°', false, `ë‹¨ê³„ ${step + 1}ì—ì„œ ì‹¤íŒ¨: ${e.message}`);
                }
            }
            
            nextStep();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            log('ğŸš€ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            setTimeout(loadApp, 1000);
        });

        // iframe ì—ëŸ¬ ê°ì§€
        document.getElementById('appFrame').addEventListener('error', (e) => {
            log(`âŒ iframe ë¡œë“œ ì—ëŸ¬: ${e.message}`, 'error');
        });
    </script>
</body>
</html>