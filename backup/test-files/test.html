<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI 운세 테스트</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N1BD4K7BV9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-N1BD4K7BV9');
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            padding: 10px 20px;
            margin: 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #5a67d8;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 4px;
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>🧪 MBTI 운세 앱 자동 테스트</h1>
    
    <div class="test-section">
        <h2>1. 초기화 테스트</h2>
        <button class="test-button" onclick="testInitialization()">초기화 테스트 실행</button>
        <div id="init-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. 화면 전환 테스트</h2>
        <button class="test-button" onclick="testScreenTransitions()">화면 전환 테스트 실행</button>
        <div id="screen-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. MBTI 선택 플로우 테스트</h2>
        <button class="test-button" onclick="testMBTIFlow()">MBTI 플로우 테스트 실행</button>
        <div id="mbti-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. 성능 측정</h2>
        <button class="test-button" onclick="testPerformance()">성능 측정 실행</button>
        <div id="perf-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>5. 광고 로딩 테스트</h2>
        <button class="test-button" onclick="testAdLoading()">광고 로딩 테스트 실행</button>
        <div id="ad-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>6. 전체 통합 테스트</h2>
        <button class="test-button" onclick="runAllTests()">모든 테스트 실행</button>
        <div id="all-result" class="result"></div>
    </div>

    <script>
        // 테스트 유틸리티
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const typeClass = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            element.innerHTML += `<div class="${typeClass}">${new Date().toLocaleTimeString()} - ${message}</div>`;
        }
        
        // 1. 초기화 테스트
        async function testInitialization() {
            const resultId = 'init-result';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                // 앱 페이지 열기
                const win = window.open('/index.html', '_blank');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 전역 객체 확인
                if (win.CONFIG) {
                    log(resultId, '✅ CONFIG 객체 로드 성공', 'success');
                } else {
                    log(resultId, '❌ CONFIG 객체 로드 실패', 'error');
                }
                
                // 성능 최적화 모듈 확인
                if (win.PerformanceOptimizer) {
                    log(resultId, '✅ 성능 최적화 모듈 로드 성공', 'success');
                } else {
                    log(resultId, '❌ 성능 최적화 모듈 로드 실패', 'error');
                }
                
                // 화면 요소 확인
                const screens = win.document.querySelectorAll('.screen');
                log(resultId, `화면 수: ${screens.length}개`);
                
                win.close();
                log(resultId, '✅ 초기화 테스트 완료', 'success');
            } catch (error) {
                log(resultId, `❌ 테스트 실패: ${error.message}`, 'error');
            }
        }
        
        // 2. 화면 전환 테스트
        async function testScreenTransitions() {
            const resultId = 'screen-result';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                const win = window.open('/index.html', '_blank');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 시작 화면 확인
                const startScreen = win.document.getElementById('startScreen');
                if (startScreen && startScreen.classList.contains('active')) {
                    log(resultId, '✅ 시작 화면 활성화 확인', 'success');
                }
                
                // Magic 버튼 클릭
                const magicBtn = win.document.querySelector('.magic-button');
                if (magicBtn) {
                    magicBtn.click();
                    await new Promise(resolve => setTimeout(resolve, 500));
                    log(resultId, '✅ Magic 버튼 클릭 성공', 'success');
                }
                
                // 스크롤 방지 확인
                win.scrollTo(0, 100);
                await new Promise(resolve => setTimeout(resolve, 100));
                if (win.scrollY === 0) {
                    log(resultId, '✅ 스크롤 방지 작동 확인', 'success');
                } else {
                    log(resultId, '⚠️ 스크롤 방지 미작동', 'warning');
                }
                
                win.close();
                log(resultId, '✅ 화면 전환 테스트 완료', 'success');
            } catch (error) {
                log(resultId, `❌ 테스트 실패: ${error.message}`, 'error');
            }
        }
        
        // 3. MBTI 플로우 테스트
        async function testMBTIFlow() {
            const resultId = 'mbti-result';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                const win = window.open('/index.html', '_blank');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // MBTI 알고 있음 선택
                win.document.querySelector('.magic-button').click();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const knowCheckbox = win.document.getElementById('knowMBTI');
                if (knowCheckbox) {
                    knowCheckbox.checked = true;
                    knowCheckbox.onchange();
                    log(resultId, '✅ MBTI 알고 있음 선택', 'success');
                }
                
                // MBTI 선택
                const mbtiSelect = win.document.getElementById('mbtiSelect');
                if (mbtiSelect && mbtiSelect.style.display !== 'none') {
                    mbtiSelect.value = 'INTJ';
                    log(resultId, '✅ MBTI 선택 UI 표시', 'success');
                }
                
                // 시작 버튼 클릭
                const startBtn = win.document.getElementById('startJourneyBtn');
                if (startBtn && !startBtn.disabled) {
                    log(resultId, '✅ 시작 버튼 활성화 확인', 'success');
                }
                
                win.close();
                log(resultId, '✅ MBTI 플로우 테스트 완료', 'success');
            } catch (error) {
                log(resultId, `❌ 테스트 실패: ${error.message}`, 'error');
            }
        }
        
        // 4. 성능 측정
        async function testPerformance() {
            const resultId = 'perf-result';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                const win = window.open('/index.html', '_blank');
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // 성능 메트릭 수집
                if (win.PerformanceOptimizer) {
                    const metrics = win.PerformanceOptimizer.measurePerformance();
                    if (metrics) {
                        log(resultId, `페이지 로드 시간: ${metrics.pageLoadTime}ms`);
                        log(resultId, `DOM 준비 시간: ${metrics.domReadyTime}ms`);
                        log(resultId, `TTFB: ${metrics.ttfb}ms`);
                        
                        if (metrics.pageLoadTime < 3000) {
                            log(resultId, '✅ 성능 목표 달성 (3초 이내)', 'success');
                        } else {
                            log(resultId, '⚠️ 성능 최적화 필요', 'warning');
                        }
                    }
                }
                
                // 메모리 사용량
                if (win.performance && win.performance.memory) {
                    const memory = win.performance.memory;
                    log(resultId, `메모리 사용: ${Math.round(memory.usedJSHeapSize / 1048576)}MB`);
                }
                
                win.close();
                log(resultId, '✅ 성능 측정 완료', 'success');
            } catch (error) {
                log(resultId, `❌ 테스트 실패: ${error.message}`, 'error');
            }
        }
        
        // 5. 광고 로딩 테스트
        async function testAdLoading() {
            const resultId = 'ad-result';
            document.getElementById(resultId).innerHTML = '';
            
            try {
                const win = window.open('/index.html', '_blank');
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // adsbykakao 객체 확인
                if (win.adsbykakao) {
                    log(resultId, '✅ adsbykakao 객체 로드 성공', 'success');
                } else {
                    log(resultId, '⚠️ adsbykakao 객체 미로드 (광고 차단기 가능성)', 'warning');
                }
                
                // 광고 컨테이너 확인
                const adContainers = win.document.querySelectorAll('.kakao_ad_area');
                log(resultId, `광고 컨테이너 수: ${adContainers.length}개`);
                
                adContainers.forEach((container, index) => {
                    if (container.children.length > 0) {
                        log(resultId, `✅ 광고 영역 ${index + 1} 렌더링 확인`, 'success');
                    } else {
                        log(resultId, `⚠️ 광고 영역 ${index + 1} 비어있음`, 'warning');
                    }
                });
                
                win.close();
                log(resultId, '✅ 광고 로딩 테스트 완료', 'success');
            } catch (error) {
                log(resultId, `❌ 테스트 실패: ${error.message}`, 'error');
            }
        }
        
        // 6. 전체 통합 테스트
        async function runAllTests() {
            const resultId = 'all-result';
            document.getElementById(resultId).innerHTML = '';
            log(resultId, '🚀 전체 테스트 시작...');
            
            await testInitialization();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testScreenTransitions();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testMBTIFlow();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testPerformance();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testAdLoading();
            
            log(resultId, '✅ 전체 테스트 완료!', 'success');
        }
    </script>
</body>
</html>